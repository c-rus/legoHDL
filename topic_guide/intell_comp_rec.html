<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Intelligent Component Recognition - legoHDL Documentation</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded "><a href="../getting_started/getting_started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting_started/1_installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../getting_started/2_initial_setup.html"><strong aria-hidden="true">1.2.</strong> Initial Setup</a></li></ol></li><li class="chapter-item expanded "><a href="../tutorials/tutorials.html"><strong aria-hidden="true">2.</strong> Tutorials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tutorials/first_project_gates.html"><strong aria-hidden="true">2.1.</strong> First Project: Gates</a></li><li class="chapter-item expanded "><a href="../tutorials/ref_blocks_comparator.html"><strong aria-hidden="true">2.2.</strong> Using Blocks: Comparator</a></li></ol></li><li class="chapter-item expanded "><a href="../user_guide/user_guide.html"><strong aria-hidden="true">3.</strong> User Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../user_guide/managing_settings.html"><strong aria-hidden="true">3.1.</strong> Managing Settings</a></li></ol></li><li class="chapter-item expanded "><a href="../topic_guide/topic_guide.html"><strong aria-hidden="true">4.</strong> Topic Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../topic_guide/intell_comp_rec.html" class="active"><strong aria-hidden="true">4.1.</strong> Intelligent Component Recognition</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/reference.html"><strong aria-hidden="true">5.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/cfg_files.html"><strong aria-hidden="true">5.1.</strong> .cfg Files</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/commands.html"><strong aria-hidden="true">6.</strong> Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/development.html"><strong aria-hidden="true">6.1.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/development/new.html"><strong aria-hidden="true">6.1.1.</strong> new</a></li><li class="chapter-item expanded "><a href="../commands/development/init.html"><strong aria-hidden="true">6.1.2.</strong> init</a></li><li class="chapter-item expanded "><a href="../commands/development/open.html"><strong aria-hidden="true">6.1.3.</strong> open</a></li><li class="chapter-item expanded "><a href="../commands/development/get.html"><strong aria-hidden="true">6.1.4.</strong> get</a></li><li class="chapter-item expanded "><a href="../commands/development/graph.html"><strong aria-hidden="true">6.1.5.</strong> graph</a></li><li class="chapter-item expanded "><a href="../commands/development/export.html"><strong aria-hidden="true">6.1.6.</strong> export</a></li><li class="chapter-item expanded "><a href="../commands/development/build.html"><strong aria-hidden="true">6.1.7.</strong> build</a></li><li class="chapter-item expanded "><a href="../commands/development/release.html"><strong aria-hidden="true">6.1.8.</strong> release</a></li><li class="chapter-item expanded "><a href="../commands/development/del.html"><strong aria-hidden="true">6.1.9.</strong> del</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/management.html"><strong aria-hidden="true">6.2.</strong> Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/management/list.html"><strong aria-hidden="true">6.2.1.</strong> list</a></li><li class="chapter-item expanded "><a href="../commands/management/refresh.html"><strong aria-hidden="true">6.2.2.</strong> refresh</a></li><li class="chapter-item expanded "><a href="../commands/management/install.html"><strong aria-hidden="true">6.2.3.</strong> install</a></li><li class="chapter-item expanded "><a href="../commands/management/uninstall.html"><strong aria-hidden="true">6.2.4.</strong> uninstall</a></li><li class="chapter-item expanded "><a href="../commands/management/download.html"><strong aria-hidden="true">6.2.5.</strong> download</a></li><li class="chapter-item expanded "><a href="../commands/management/update.html"><strong aria-hidden="true">6.2.6.</strong> update</a></li><li class="chapter-item expanded "><a href="../commands/management/info.html"><strong aria-hidden="true">6.2.7.</strong> info</a></li><li class="chapter-item expanded "><a href="../commands/management/config.html"><strong aria-hidden="true">6.2.8.</strong> config</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">7.</strong> Appendix: Glossary</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">legoHDL Documentation</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="intelligent-component-recognition-icr"><a class="header" href="#intelligent-component-recognition-icr">Intelligent Component Recognition (ICR)</a></h1>
<p>Both VHDL and Verilog have limited levels of scopes; although VHDL has libraries for design units, Verilog has no such concept.</p>
<p>This page describes how legoHDL handles <em>scope-overlapping</em>.</p>
<h3 id="what-is-scope-overlapping"><a class="header" href="#what-is-scope-overlapping">What is <em>scope-overlapping?</em></a></h3>
<p>For this document, we define <em>scope-overlapping</em> to be when two unique design units share the same scope and identifier.</p>
<h2 id="the-problem"><a class="header" href="#the-problem">The Problem</a></h2>
<p>Take two design units available for use in your legoHDL workspace.</p>
<ul>
<li>math.ALU:adder
<ul>
<li>an entity named <em>adder</em> found in the block <em>ALU</em> under the library <em>math</em></li>
</ul>
</li>
</ul>
<pre><code class="language-VHDL">-- Block: math.ALU
-- Entity: adder
entity adder is 
    generic ( 
        N : positive := 8 
    );
    port (
        c_in  : in  std_logic; 
        a     : in  std_logic_vector(N-1 downto 0);
        b     : in  std_logic_vector(N-1 downto 0);
        sum   : out std_logic_vector(N-1 downto 0);
        c_out : out std_logic
    );
end entity;
</code></pre>
<ul>
<li>math.counter:adder
<ul>
<li>an entity named <em>adder</em> found in the block <em>counter</em> under the library <em>math</em></li>
</ul>
</li>
</ul>
<pre><code class="language-VHDL">-- Block: math.counter
-- Entity: adder
entity adder is
    generic ( 
        N : positive := 32
    );
    port (
         c_in   : in  std_logic;
         input1 : in  std_logic_vector(N-1 downto 0);
         input2 : in  std_logic_vector(N-1 downto 0);
         sum    : out std_logic_vector(N-1 downto 0);
         c_out  : out std_logic
    );
end entity;
</code></pre>
<p><em>Scope-overlapping</em> occurs between these two entities because they share the same identifier, which consists of their entity name and library name.</p>
<p>If taking a VHDL coding approach, both entities could be instantiated with the following code.</p>
<pre><code class="language-VHDL">u_ADD : entity math.adder 
    generic map ( 
        ... 
    ) port map ( 
        ... 
    );
</code></pre>
<p>The problem lies in that <code>math.adder</code> may refer to either entity.</p>
<p>As the developer, your latest project involves using the adder from the <em>counter</em> block, yet how would legoHDL know this when the identifiers to instantiate the unit is the same?</p>
<h2 id="the-solution-icr"><a class="header" href="#the-solution-icr">The Solution: ICR</a></h2>
<p>ICR is a scoring algorithm ran when <em>scope-overlapping</em> occurs in the current design. It selects the unit with the highest computed score among its contenders. </p>
<p>We define a <em>contender</em> to be those unique entities that share the same space a in <em>scope-overlapping</em> problem. In the problem statement above, there are 2 contenders: the <em>adder</em> from <em>math.ALU</em> and the <em>adder</em> from <em>math.counter</em>.</p>
<p>We define an <em>interface</em> as the collective combination of an entity's defined generics and ports.</p>
<p>We define the <em>instance</em> as the code that could lead to multiple entity solutions based off its identifier (<code>math.adder</code> in the problem stated). </p>
<p>ICR gathers the interface data from all contenders as well as the interface data defined in the mapping of the instance. Based on this data and a set of known rules, it begins to calculate scores and rule out ineligible contenders.</p>
<p>Some rules are the following:</p>
<ul>
<li>+1 point is awarded to a contender for having a matching interface piece with the instance</li>
<li>An output port can be omitted/left unconnected and a contender can still remain elgibile.</li>
<li>If a contender's interface does not define a default value for a generic or an input port, the instance must have that generic or input port mapped. Failure to have this mapping will cause the contender to be ineligible.</li>
<li>If any generic or port from the instance is not found in the contender's interface, the contender must be ruled inelgibile.</li>
</ul>
<h2 id="solving-the-problem"><a class="header" href="#solving-the-problem">Solving the problem</a></h2>
<p>Using the <code>legohdl get</code> command, you as the developer would instantiate the <em>adder</em> from <em>counter</em> with the following output.</p>
<pre><code>$ legohdl get math.counter:adder -inst
--- ABOUT ---
------------------------------------------------------------------------------
 Block: math.counter
 Entity: adder
 Description:
  Instantiates N full adders to create a N-bit ripple carry adder
  architecture.
------------------------------------------------------------------------------

--- CODE ---
constant N : positive := 8;

signal w_cin    : std_logic;
signal w_input1 : std_logic_vector(N-1 downto 0);
signal w_input1 : std_logic_vector(N-1 downto 0);
signal w_sum    : std_logic_vector(N-1 downto 0);
signal w_cout   : std_logic;

uX : entity math.adder generic map(
        N =&gt; N)
    port map(
        c_in   =&gt; w_c_in,
        input1 =&gt; w_input1,
        input2 =&gt; w_input2,
        sum    =&gt; w_sum,
        c_out  =&gt; w_cout);
</code></pre>
<p>Within your latest entity's architecture, you have instantiated the <code>math.adder</code> entity.</p>
<pre><code class="language-VHDL">architecture ...
begin
    ...

    --please use the adder from our counter block here!
    u_ADD : entity math.adder generic map(
            N =&gt; N)
        port map(
            c_in   =&gt; w_c_in,
            input1 =&gt; w_input1,
            input2 =&gt; w_input2,
            sum    =&gt; w_sum,
            c_out  =&gt; w_cout);

    ...
end architecture;
</code></pre>
<p>To build the latest design, we must export the <a href="./../glossary.html#blueprint">blueprint</a> file for our <a href="./../glossary.html#plugin">plugin</a> to use.</p>
<p>During export, ICR is ran to determine which contender the given instance should belong to in order to complete the design hierarchy tree.</p>
<p>Data collected for contenders labeled as A and B:</p>
<table><thead><tr><th>instance</th><th>math.counter:adder (A)</th><th>math.ALU:counter (B)</th></tr></thead><tbody>
<tr><td>N (G)</td><td>N (G*)</td><td>N (G*)</td></tr>
<tr><td>c_in</td><td>c_in (IN)</td><td>c_in (IN)</td></tr>
<tr><td>input1</td><td>input1 (IN)</td><td>a (IN)</td></tr>
<tr><td>input2</td><td>input2 (IN)</td><td>b (IN)</td></tr>
<tr><td>sum</td><td>sum (OUT)</td><td>sum (OUT)</td></tr>
<tr><td>c_out</td><td>c_out (OUT)</td><td>c_out (OUT)</td></tr>
</tbody></table>
<blockquote>
<p><strong>Note:</strong> A '(G)' represents a generic defined, while '(IN)' and '(OUT)' represents input and output ports, respectively. Notice for the instance we are unable to determine the port directions from code. A '*' indicates it has a default value (and thus may be omitted from the instance code).</p>
</blockquote>
<p>Since both A and B have the generic N, we cannot determine which one the instance belongs to yet. We move on to the ports.</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>1</td><td>1</td></tr>
</tbody></table>
<p>Both A and B have an input port &quot;c_in&quot;, and the instance must define this connection for either contender because there's no default value. However, this port gives no insight as the name is identical in both contenders.</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>2</td><td>2</td></tr>
</tbody></table>
<p>Contender A has an input port &quot;input1&quot;, which matches with a name in the instance's interface. A's score gets +1. Contender B has no such port, and thus it is ineligible. At this point ICR knows which entity the instance belongs to. We will carry the remaining checks out for completeness.</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>3</td><td>0</td></tr>
</tbody></table>
<p>Contender A has an input port &quot;input2&quot;, which matches a name in the instance's interface and thus gets +1. Contender B no longer can check against the instance interface due to being previously ineligible/disqualified.</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>4</td><td>0</td></tr>
</tbody></table>
<p>Contender A's port &quot;sum&quot; matches with a port in the instance.</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>5</td><td>0</td></tr>
</tbody></table>
<p>Contender A's port &quot;c_out&quot; matches with a port in the instance.</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>6</td><td>0</td></tr>
</tbody></table>
<p>There are no more interface pieces in the instance to check. Scoring is done. Scores are transformed into a percentage.</p>
<p><em>contender's %-score</em> = (<em>contender's score</em>) / (<em>total instance interface elements</em>)</p>
<table><thead><tr><th>contender A</th><th>contender B</th></tr></thead><tbody>
<tr><td>100%</td><td>0%</td></tr>
</tbody></table>
<p>ICR selected contender A, which was the <em>math.counter:adder</em> entity. This was what we wanted!</p>
<h2 id="pitfalls"><a class="header" href="#pitfalls">Pitfalls</a></h2>
<p>There are 2 methods to instantiating a unit in VHDL and Verilog: positional association and name association. Name association is generally recommended and is the format legoHDL outputs compatible code. However, positional association is still a synthesizable construct and based on the previous problem could hinder ICR.</p>
<p>When positional association is used, legoHDL loses data on what the interface names are to cross-check with the contenders. The only data it can collect is on the number of connections in the instance's interface. See <a href="./intell_comp_rec.html#more-icr-examples">more examples</a> to see how ICR performs when encountering positional association.</p>
<p>I don’t think there is a single synthesis tool that will support a design using more than one unique entity from the same <em>scope-overlapping</em> space, even though legoHDL can distinguish when each one is used in context from ICR. For this, a design may be limited to only using one of these unique entities for every <em>scope-overlapping</em> problem, yet all the entities are allowed to coexist through legoHDL.</p>
<p>This means any time the same <em>scope-overlapping</em> problem appears in a design, it must select the same entity every time in order to be synthesizable.</p>
<p>If a design would not select the same entity every time when running ICR, an extra layer of scope could be added to an entity’s name by prepending the block name to the entity name. For example, making <code>entity ALU_adder</code> and <code>entity counter_adder</code>. This would resolve the <em>scope-overlapping</em> problem and avoid running ICR entirely.</p>
<h2 id="more-icr-examples"><a class="header" href="#more-icr-examples">More ICR examples</a></h2>
<h3 id="positional-association"><a class="header" href="#positional-association">positional association</a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../topic_guide/topic_guide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../reference/reference.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../topic_guide/topic_guide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../reference/reference.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
